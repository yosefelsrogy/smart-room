<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smart Home - Live Status</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; }
        h2 { color: #38bdf8; }
        .card { background: #1e293b; padding: 20px; margin: 15px auto; border-radius: 20px; max-width: 350px; box-shadow: 0 10px 15px rgba(0,0,0,0.3); border: 1px solid #334155; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-left: 10px; }
        .on-status { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .off-status { background: #ef4444; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .on-btn { background: #22c55e; color: white; }
        .off-btn { background: #ef4444; color: white; }
        button:active { transform: scale(0.9); }
        .loading { font-size: 0.8rem; color: #94a3b8; }
    </style>
</head>
<body>

    <h2>ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h2>
    <div id="devices-container">
        </div>

    <script>
        const APP_KEY = "b50f1ba3-62a9-481e-8a36-7675c4edadbc"; 
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡
        const devices = [
            { id: '697988922c0599192ae83298', name: 'Ø§Ù„Ù„Ù…Ø¨Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰' },
            { id: '697989702c0599192ae83307', name: 'Ø§Ù„Ù„Ù…Ø¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©' },
            { id: '697989de40cb098d90c7aad7', name: 'Ø§Ù„Ù„Ù…Ø¨Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©' }
        ];

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
        function renderDevices() {
            const container = document.getElementById('devices-container');
            container.innerHTML = devices.map(dev => `
                <div class="card" id="card-${dev.id}">
                    <h3>${dev.name} <span id="ind-${dev.id}" class="status-indicator off-status"></span></h3>
                    <div class="status-text" id="status-${dev.id}">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
                    <div class="btn-group">
                        <button class="on-btn" onclick="sendAction('${dev.id}', 'On')">ØªØ´ØºÙŠÙ„</button>
                        <button class="off-btn" onclick="sendAction('${dev.id}', 'Off')">Ø¥Ø·ÙØ§Ø¡</button>
                    </div>
                </div>
            `).join('');
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        async function getStatus(deviceId) {
            try {
                const response = await fetch(`https://api.sinric.pro/api/v1/devices/${deviceId}`, {
                    headers: { 'x-sinric-appkey': APP_KEY }
                });
                const data = await response.json();
                const state = data.payload.state.powerState; // On or Off
                updateUI(deviceId, state);
            } catch (err) {
                console.error("Status error", err);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
        function updateUI(deviceId, state) {
            const ind = document.getElementById(`ind-${deviceId}`);
            const txt = document.getElementById(`status-${deviceId}`);
            if (state.toLowerCase() === 'on') {
                ind.className = 'status-indicator on-status';
                txt.innerText = 'Ø§Ù„Ø­Ø§Ù„Ø©: ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†';
                txt.style.color = '#22c55e';
            } else {
                ind.className = 'status-indicator off-status';
                txt.innerText = 'Ø§Ù„Ø­Ø§Ù„Ø©: Ù…Ø·ÙØ£Ø©';
                txt.style.color = '#ef4444';
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± (ØªØ´ØºÙŠÙ„/Ø¥Ø·ÙØ§Ø¡) ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙˆØ±Ø§Ù‹
        async function sendAction(deviceId, value) {
            try {
                await fetch(`https://api.sinric.pro/api/v1/devices/${deviceId}/action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-sinric-appkey': APP_KEY },
                    body: JSON.stringify({ "action": "setPowerState", "value": { "state": value } })
                });
                updateUI(deviceId, value); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ·
            } catch (err) {
                alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„");
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„
        renderDevices();
        // Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        devices.forEach(d => getStatus(d.id));
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
        setInterval(() => devices.forEach(d => getStatus(d.id)), 10000);

    </script>
</body>
</html>